---
import data from '../data/flickr-photos.json';
const allPhotos = data || [];
const photosToShow = allPhotos.slice(0, 10);
const hasPhotos = photosToShow.length > 0;

const getRelativeTime = (dateStr) => {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  const now = new Date();
  
  // Reset times to compare calendar days
  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
  const n = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  
  const diffTime = n - d;
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays === 0) return "Today";
  if (diffDays === 1) return "Yesterday";
  if (diffDays < 7) return `Last ${date.toLocaleDateString('en-US', { weekday: 'long' })}`;
  
  if (date.getFullYear() === now.getFullYear()) {
     return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  }
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};
---

{hasPhotos ? (
  <section class="my-16 animate" data-testid="flickr-section">
    <div class="flex justify-between items-baseline mb-4 border-b border-black/10 dark:border-white/10 pb-4">
      <h3 class="font-semibold text-black dark:text-white text-lg">Photo Archive</h3>
      <a href="https://www.flickr.com/photos/ed_welker/" class="text-[9px] font-mono uppercase tracking-[0.1em] text-neutral-400 hover:text-black dark:hover:text-white transition-colors group">
        Flickr <span class="inline-block transition-transform group-hover:translate-x-0.5">â†’</span>
      </a>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 auto-rows-[120px] md:auto-rows-[160px]">
      {photosToShow.map((photo, i) => {
        const isTopHero = i === 0;
        const isBottomHero = i === 9;
        let spanClass = "col-span-1 row-span-1";
        if (isTopHero) spanClass = "col-span-2 row-span-2";
        if (isBottomHero) spanClass = "col-span-2 row-span-2 md:col-start-3 md:row-start-3";

        return (
          <div class={`${spanClass} group relative overflow-hidden bg-neutral-100 dark:bg-neutral-900 border border-black/5 dark:border-white/5`}>
            <a href={`https://www.flickr.com/photos/ed_welker/${photo.id}`} target="_blank" rel="noopener noreferrer" class="block w-full h-full">
              <img src={photo.src} alt={photo.title || 'Flickr photo'} loading="lazy" class="w-full h-full object-cover transition-all duration-700 group-hover:scale-105 group-hover:brightness-110" />
              <div class="absolute top-2 right-2 px-2 py-1 bg-black/60 backdrop-blur-md rounded shadow-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <span class="text-white/90 font-mono font-bold text-[10px] uppercase tracking-wider block">
                  {getRelativeTime(photo.date)}
                </span>
              </div>
            </a>
          </div>
        );
      })}
    </div>
  </section>
) : (
  <div data-flickr-empty style="display: none;" />
)}
