---
import data from '../data/flickr-photos.json'; 

// Defensive coding: handle missing or empty data
const photos = data || [];
const photosToShow = photos.slice(0, 10);
const hasPhotos = photosToShow.length > 0;
---

{hasPhotos ? (
  <section class="my-10" data-testid="flickr-section">
    <h2 class="font-semibold mb-6 border-b pb-2">Latest Photos from Flickr</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
      {photosToShow.map((photo) => (
        <a 
          href={`https://www.flickr.com/photos/ed_welker/${photo.id}`} 
          target="_blank" 
          rel="noopener noreferrer" 
          class="block overflow-hidden rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 relative aspect-square"
        >
          <img
            src={photo.src}
            alt={photo.title || 'Flickr photo'}
            width="320"
            height="240"
            loading="lazy"
            class="w-full h-full aspect-square object-cover absolute inset-0"
          />
          <p class="text-xs p-1 text-gray-500 truncate" title={photo.title}>
            {photo.title}
          </p>
        </a>
      ))}
    </div>
  </section>
) : (
  <div data-flickr-empty style="display: none;" data-testid="flickr-empty-marker">
    Flickr data is empty or missing
  </div>
)}
