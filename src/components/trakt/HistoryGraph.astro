---
import type { SparklineDecade } from './types';

interface Props {
  sparkline: SparklineDecade[];
}

const { sparkline } = Astro.props;
const maxVol = Math.max(...sparkline.map((s) => s.volume), 1);
---

<section class="animate space-y-6">
  <div class="space-y-2">
    <h2 class="font-mono text-xs font-bold tracking-[0.3em] text-neutral-500 uppercase">
      The History Map
    </h2>
    <div class="max-w-xl space-y-2 text-xs leading-relaxed text-neutral-500">
      <p>
        This graph visualizes cinematic quality versus consumption volume. The orange bars represent
        items watched per decade; the floating dots represent the average quality.
      </p>
      <p class="font-mono text-[10px]">
        Note: A high dot signifies higher average ratings for that decade despite more movies rated.
      </p>
    </div>
  </div>
  <div class="flex h-20 items-end gap-2 pt-4">
    {
      sparkline.map((s) => (
        <a
          href={`/media/${s.decade}`}
          class="group relative flex h-full flex-1 flex-col items-center justify-end"
        >
          <div
            class="w-full rounded-t-sm bg-orange-600/10 transition-colors group-hover:bg-orange-600/40"
            style={`height: ${(s.volume / maxVol) * 100}%`}
          >
            <div
              class="absolute bottom-0 left-1/2 h-1.5 w-1.5 -translate-x-1/2 rounded-full border border-white bg-orange-600 shadow-sm dark:border-black"
              style={`bottom: ${((parseFloat(s.score) - 5) / 5) * 100}%`}
            />
          </div>
          <span class="mt-2 font-mono text-[9px] text-neutral-500">{s.decade}s</span>
        </a>
      ))
    }
  </div>
</section>
