---
import Link from "@components/Link.astro";
import { getPostHref } from "@lib/blog";

const { post } = Astro.props;

function getPostImage(post) {
  const image = post.data.coverImage || post.data.coverPhoto || post.data.heroImage;
  if (image) {
    return image.src || image;
  }
  const markdownImage = post.body.match(/!\[[^\]]*\]\(([^)\s]+)/);
  if (markdownImage) return markdownImage[1];
  const htmlImage = post.body.match(/<img[^>]+src=["']([^"']+)["']/);
  if (htmlImage) return htmlImage[1];
  return undefined;
}

const coverImage = getPostImage(post);
---

<li>
  <Link href={getPostHref(post)} class="group block no-underline">
    <div class="flex justify-between items-center gap-4">
      <div class="flex flex-col gap-1">
        <span class="font-medium text-black dark:text-white group-hover:underline decoration-1 underline-offset-2 leading-tight">
          {post.data.title}
        </span>
        <p class="text-xs text-neutral-500">
          {post.data.date.getUTCFullYear()}-{String(post.data.date.getUTCMonth() + 1).padStart(2, '0')}-{String(post.data.date.getUTCDate()).padStart(2, '0')}
        </p>
      </div>
      {coverImage && (
        <div class="shrink-0 w-24 h-24 overflow-hidden rounded-md bg-neutral-100 dark:bg-neutral-800">
          <img
            src={coverImage}
            alt={post.data.title}
            class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
          />
        </div>
      )}
    </div>
  </Link>
</li>
