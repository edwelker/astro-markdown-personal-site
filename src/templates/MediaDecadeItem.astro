---
import Layout from '@layouts/Layout.astro';
import Container from '@components/Container.astro';
import BackToPrevious from '@components/BackToPrevious.astro';
import traktData from '../data/trakt.json';

export async function getStaticPaths() {
  const { sparkline } = traktData;
  return sparkline.map((s: any) => ({
    params: { decade: s.decade.toString() },
    props: { decade: s.decade },
  }));
}

const { decade } = Astro.props;
const { allRatings } = traktData;

const decadeMovies = (allRatings as any[])
  .filter((m) => Math.floor(m.year / 10) * 10 === decade)
  .sort((a, b) => b.rating - a.rating);

const title = `${decade}s Archive`;

const schema = {
  '@context': 'https://schema.org',
  '@graph': decadeMovies.map((item) => ({
    '@type': 'Review',
    itemReviewed: {
      '@type': item.type === 'show' ? 'TVSeries' : 'Movie',
      name: item.title,
      image: item.poster,
    },
    reviewRating: {
      '@type': 'Rating',
      ratingValue: item.rating,
      bestRating: '10',
      worstRating: '1',
    },
    author: {
      '@type': 'Person',
      name: 'Eddie Welker',
    },
  })),
};
---

<Layout title={title} description={`Cinematic history from the ${decade}s.`}>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
  <Container>
    <div class="animate">
      <BackToPrevious href="/media/" />
      <div class="h-24 w-full"></div>

      <header class="mb-12">
        <h1 class="text-3xl font-black tracking-tighter text-black uppercase dark:text-white">
          The {decade}s
        </h1>
        <p class="mt-2 font-mono text-sm text-neutral-500">
          {decadeMovies.length} items archived from this era.
        </p>
      </header>

      <div class="grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5">
        {
          decadeMovies.map((item) => (
            <div class="group space-y-3">
              <a
                href={item.href}
                target="_blank"
                class="relative block aspect-[2/3] overflow-hidden rounded-lg border border-black/5 bg-neutral-900 transition-transform hover:scale-[1.02] dark:border-white/5"
              >
                <img
                  src={item.poster}
                  alt={item.title}
                  class="absolute inset-0 h-full w-full object-cover"
                  loading="lazy"
                />
                <div class="absolute right-2 bottom-2 rounded border border-white/10 bg-black/80 px-2 py-1 backdrop-blur-md">
                  <span class="text-[10px] font-bold text-white">
                    {item.rating} <span class="font-normal text-orange-500">â˜…</span>
                  </span>
                </div>
              </a>
              <div class="px-0.5">
                <p class="text-xs leading-tight font-bold text-neutral-800 uppercase dark:text-neutral-200">
                  {item.title}
                </p>
                <p class="mt-1 font-mono text-[10px] text-neutral-500">{item.year}</p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </Container>
</Layout>
