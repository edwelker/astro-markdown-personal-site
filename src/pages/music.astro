---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import BackToPrevious from "@components/BackToPrevious.astro";
import musicData from "../data/music.json";

// Types to keep TS happy if you use it, or just for clarity
type Track = { name: string; artist: string; url: string; image: string; plays?: string; date?: string; nowPlaying?: boolean };
type Album = { name: string; artist: string; url: string; image: string };
type Artist = { name: string; url: string; plays: string };

const { user, recent, artists, albums, tracks } = musicData;

const title = "Listening Habits";
const description = "A detailed look at what I've been listening to.";
---

<Layout title={title} description={description}>
  <Container>
    <div class="animate">
      <BackToPrevious href="/" />

      <header class="mb-12 mt-8">
        <h1 class="font-semibold text-2xl text-black dark:text-white mb-2">Music Stats</h1>
        <p class="text-neutral-500 text-sm">
          Lifetime Scrobbles: <span class="text-black dark:text-white font-mono">{user.scrobbles.toLocaleString()}</span>
        </p>
      </header>

      <div class="space-y-16">

        {/* SECTION 1: RECENTLY PLAYED (Simple List) */}
        <section class="space-y-4">
          <h2 class="font-semibold text-black dark:text-white">
            Recently Played
          </h2>
          <div class="flex flex-col divide-y divide-neutral-200 dark:divide-neutral-700 border-y border-neutral-200 dark:border-neutral-700">
            {recent.map((track: Track) => (
              <a
                href={track.url}
                target="_blank"
                class="group flex items-center justify-between py-3 hover:bg-neutral-50 dark:hover:bg-white/5 transition-colors px-2 -mx-2"
              >
                <div class="flex items-center gap-3 overflow-hidden">
                  <img src={track.image} alt="" class="w-10 h-10 rounded-sm bg-neutral-200 object-cover shrink-0 grayscale group-hover:grayscale-0 transition-all" />
                  <div class="flex flex-col min-w-0">
                    <span class="text-sm font-medium text-black dark:text-white truncate group-hover:underline decoration-1 underline-offset-2">
                      {track.name}
                    </span>
                    <span class="text-xs text-neutral-500 truncate">
                      {track.artist}
                    </span>
                  </div>
                </div>

                <div class="text-xs font-mono shrink-0 text-right pl-4">
                  {track.nowPlaying ? (
                    <span class="text-green-600 dark:text-green-400 animate-pulse">NOW</span>
                  ) : (
                    <span class="text-neutral-400">{track.date}</span>
                  )}
                </div>
              </a>
            ))}
          </div>
        </section>

        {/* SECTION 2: TOP ALBUMS (Grid with Minimal Borders) */}
        <section class="space-y-4">
          <h2 class="font-semibold text-black dark:text-white">
            Top Albums (Year)
          </h2>
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
            {albums.yearly.map((album: Album) => (
              <a
                href={album.url}
                target="_blank"
                class="group block space-y-2"
              >
                <div class="aspect-square overflow-hidden rounded border border-neutral-200 dark:border-neutral-700">
                  <img
                    src={album.image}
                    alt={album.name}
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 grayscale group-hover:grayscale-0"
                    loading="lazy"
                  />
                </div>
                <div class="pr-2">
                  <div class="text-sm font-medium text-black dark:text-white truncate group-hover:underline decoration-1 underline-offset-2">
                    {album.name}
                  </div>
                  <div class="text-xs text-neutral-500 truncate">
                    {album.artist}
                  </div>
                </div>
              </a>
            ))}
          </div>
        </section>

        <div class="grid md:grid-cols-2 gap-12">

          {/* SECTION 3: TOP ARTISTS (Arrow List Style) */}
          <section class="space-y-4">
            <h2 class="font-semibold text-black dark:text-white">
              All-Time Artists
            </h2>
            <ul class="space-y-2">
              {artists.allTime.map((artist: Artist, index: number) => (
                <li class="flex items-baseline justify-between group">
                  <a href={artist.url} target="_blank" class="flex items-center gap-2 truncate text-neutral-600 dark:text-neutral-400 hover:text-black dark:hover:text-white transition-colors">
                    <span class="text-xs font-mono text-neutral-400 w-4">{index + 1}.</span>
                    <span class="truncate group-hover:underline decoration-1 underline-offset-2">{artist.name}</span>
                  </a>
                  <span class="text-xs font-mono text-neutral-400 shrink-0">
                    {parseInt(artist.plays).toLocaleString()}
                  </span>
                </li>
              ))}
            </ul>
          </section>

          {/* SECTION 4: TOP TRACKS MONTH (Arrow List Style) */}
          <section class="space-y-4">
            <h2 class="font-semibold text-black dark:text-white">
              Top Tracks (Month)
            </h2>
            <ul class="space-y-2">
              {tracks.monthly.map((track: Track, index: number) => (
                <li class="flex items-start justify-between group">
                  <div class="flex items-center gap-2 min-w-0">
                    <span class="text-xs font-mono text-neutral-400 w-4 shrink-0">{index + 1}.</span>
                    <div class="flex flex-col min-w-0">
                      <span class="text-sm text-neutral-800 dark:text-neutral-200 truncate">{track.name}</span>
                      <span class="text-xs text-neutral-500 truncate">{track.artist}</span>
                    </div>
                  </div>
                </li>
              ))}
            </ul>
          </section>

        </div>

        <div class="text-center pt-8 border-t border-neutral-200 dark:border-neutral-700">
           <a href={`https://last.fm/user/ed_welker`} target="_blank" class="text-xs text-neutral-400 hover:text-black dark:hover:text-white transition-colors">
             View full profile on Last.fm â†—
           </a>
        </div>

      </div>
    </div>
  </Container>
</Layout>
