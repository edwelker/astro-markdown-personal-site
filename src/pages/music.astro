---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import BackToPrevious from "@components/BackToPrevious.astro";
import MusicList from "@components/MusicList.astro";
import AlbumGrid from "@components/AlbumGrid.astro";
import musicData from "../data/music.json";

const { 
  user = { scrobbles: 0 }, 
  week = { albums: [], artists: [], tracks: [] }, // Label as 2 Weeks
  month = { albums: [], artists: [], tracks: [] }, // Label as 3 Months
  year = { albums: [], artists: [], tracks: [] }, 
  allTime = { albums: [], artists: [], tracks: [] } 
} = musicData || {};

const title = "Listening Habits";
const description = "A detailed look at my music rotation.";
---

<Layout title={title} description={description}>
  <Container>
    <div class="animate">
      <BackToPrevious href="/" />

      <div class="h-24 md:h-32 w-full block"></div>

      <header class="mb-12 flex justify-between items-end">
        <div>
          <h1 class="font-bold text-2xl text-black dark:text-white mb-2">Music Stats</h1>
          <p class="text-neutral-500 text-sm">
            Lifetime Scrobbles: <span class="text-black dark:text-white font-mono font-bold">{(user.scrobbles || 0).toLocaleString()}</span>
          </p>
        </div>
        <a href="https://last.fm/user/edwelker" target="_blank" class="text-xs text-neutral-400 hover:text-black dark:hover:text-white transition-colors mb-1.5 no-underline font-semibold">
          last.fm ↗
        </a>
      </header>

      <div class="space-y-20 pb-20">

        <section class="space-y-8">
          <h2 class="text-xl font-bold text-black dark:text-white border-b-2 border-black dark:border-white pb-2">Last 2 Weeks</h2>
          <div class="space-y-12">
            <AlbumGrid items={week.albums} limit={7} />
            <div class="grid md:grid-cols-2 gap-8 md:gap-12">
              <MusicList title="Top Songs" items={week.tracks} limit={5} showArtist />
              <MusicList title="Top Artists" items={week.artists} limit={5} />
            </div>
          </div>
        </section>

        <section class="space-y-8">
          <h2 class="text-xl font-bold text-black dark:text-white border-b-2 border-black dark:border-white pb-2">Last 3 Months</h2>
          <div class="space-y-12">
            <AlbumGrid items={month.albums} limit={7} />
            <div class="grid md:grid-cols-2 gap-8 md:gap-12">
              <MusicList title="Top Songs" items={month.tracks} limit={5} showArtist />
              <MusicList title="Top Artists" items={month.artists} limit={5} />
            </div>
          </div>
        </section>

        <section class="space-y-8">
          <h2 class="text-xl font-bold text-black dark:text-white border-b-2 border-black dark:border-white pb-2">Last 12 Months</h2>
          <div class="space-y-12">
            <AlbumGrid items={year.albums} limit={12} />
            <div class="grid md:grid-cols-2 gap-8 md:gap-12">
              <MusicList title="Top Songs" items={year.tracks} limit={10} showArtist />
              <MusicList title="Top Artists" items={year.artists} limit={10} />
            </div>
          </div>
        </section>

        <section class="space-y-8">
          <h2 class="text-xl font-bold text-black dark:text-white border-b-2 border-black dark:border-white pb-2">All Time</h2>
          <div class="space-y-12">
            <AlbumGrid items={allTime.albums} limit={12} />
            <div class="grid md:grid-cols-2 gap-8 md:gap-12">
              <MusicList title="Top Songs" items={allTime.tracks} limit={10} showArtist />
              <MusicList title="Top Artists" items={allTime.artists} limit={10} />
            </div>
          </div>
        </section>

        <div class="text-center pt-16 border-t border-neutral-100 dark:border-neutral-800">
           <a href="https://last.fm/user/edwelker" target="_blank" class="text-xs text-neutral-400 hover:text-black dark:hover:text-white transition-colors no-underline font-semibold">
             View full profile on Last.fm ↗
           </a>
        </div>

      </div>
    </div>
  </Container>
</Layout>
