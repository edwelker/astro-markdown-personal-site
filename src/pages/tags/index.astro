---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";

const posts = await getCollection("blog", ({ data }) => !data.draft);

// 1. Calculate counts
const tagCounts = posts.reduce((acc, post) => {
  (post.data.tags || []).forEach((tag) => {
    acc[tag] = (acc[tag] || 0) + 1;
  });
  return acc;
}, {} as Record<string, number>);

const tags = Object.keys(tagCounts).sort();

// 2. Find Min/Max for sizing logic
const counts = Object.values(tagCounts);
const minCount = Math.min(...counts);
const maxCount = Math.max(...counts);

// Function to determine font size class based on popularity
function getSizeClass(count: number) {
  if (count === minCount) return "text-xs opacity-60"; // Rare tags
  if (count === maxCount) return "text-3xl font-bold text-indigo-600"; // Top tags

  // Linear interpolation for the rest
  const percent = (count - minCount) / (maxCount - minCount);
  if (percent < 0.25) return "text-sm opacity-80";
  if (percent < 0.5) return "text-base font-medium";
  if (percent < 0.75) return "text-lg font-semibold";
  return "text-xl font-bold";
}
---

<Layout title="Topics" description="Tag Cloud">
  <Container>
    <h1 class="font-semibold text-2xl mb-8">Topics</h1>

    {/* Tag Cloud Layout: Centered, wrapping, aligned by baseline */}
    <div class="flex flex-wrap items-baseline justify-center gap-x-6 gap-y-3 text-center">
      {tags.map((tag) => (
        <a
          href={`/tags/${tag}`}
          class={`transition-colors hover:text-indigo-500 dark:hover:text-indigo-400 ${getSizeClass(tagCounts[tag])}`}
        >
          {tag}
        </a>
      ))}
    </div>
  </Container>
</Layout>
