---
import PageLayout from "@layouts/PageLayout.astro";
import Link from "@components/Link.astro";
import { HIGHLIGHTS } from "@consts";
import { getAllHighlights } from "@lib/highlights";
import HighlightSchema from "@components/HighlightSchema.astro";
import { getHighlightIcon, enrichHighlightsWithImages } from "../data/highlights";

const highlights = await getAllHighlights();
const enrichedHighlights = await enrichHighlightsWithImages(highlights);
---

<PageLayout title={HIGHLIGHTS.TITLE} description={HIGHLIGHTS.DESCRIPTION}>
  <HighlightSchema items={enrichedHighlights} slot="head" />
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 auto-rows-fr not-prose">
    {enrichedHighlights.map((item, index) => {
      const icon = item.type ? getHighlightIcon(item.type) : null;
      const hasImage = !!item.image;

      return (
        <div class={`relative group flex flex-col justify-between p-4 rounded-xl transition-all hover:scale-[1.01] ${index === 0 ? "sm:col-span-2" : ""} ${hasImage ? "bg-neutral-900 overflow-hidden" : "bg-neutral-50 dark:bg-white/5 border border-black/5 dark:border-white/10 hover:border-black/10 dark:hover:border-white/20"}`}>
          
          {hasImage && (
            <>
              <img 
                src={item.image} 
                alt="" 
                referrerpolicy="no-referrer"
                class="absolute inset-0 w-full h-full object-cover opacity-80 transition-transform duration-700 group-hover:scale-105" 
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-black/20" />
            </>
          )}

          <div class={`relative z-10 flex flex-col gap-2 ${hasImage ? "text-white" : ""}`}>
            <div class="flex items-start justify-between gap-2">
              <div class="flex items-start gap-2">
                {icon && (
                  <span class={`mt-0.5 shrink-0 ${hasImage ? "text-white/80" : "text-neutral-400 dark:text-neutral-500"}`} set:html={icon} />
                )}
                <Link href={item.url} external={item.url.startsWith("http")} aria-label={item.title} class={`font-medium text-base leading-tight after:absolute after:inset-0 ${hasImage ? "text-white" : "text-black dark:text-white"}`}>
                  {item.title}
                </Link>
              </div>
              {item.url.startsWith("http") && <span class={`text-xs shrink-0 mt-0.5 ${hasImage ? "text-white/70" : "text-neutral-400"}`}>â†—</span>}
            </div>
            <p class={`text-sm leading-snug ${hasImage ? "text-white/80" : "text-neutral-600 dark:text-neutral-400"}`}>
              {item.description}
            </p>
          </div>
          {item.thought && (
            <div class={`mt-3 pt-3 border-t text-xs relative z-10 ${hasImage ? "border-white/20 text-white/70" : "border-black/5 dark:border-white/5 text-neutral-500"}`}>
              <span class={`italic [&_a]:underline [&_a:hover]:text-white ${hasImage ? "[&_a]:decoration-white/50" : "[&_a]:decoration-neutral-400 dark:[&_a]:decoration-neutral-600 [&_a:hover]:text-black dark:[&_a:hover]:text-white"}`} set:html={item.thought} />
            </div>
          )}
        </div>
      );
    })}
  </div>
</PageLayout>
